name: Push Build to Artifactory 

on: [push]
permissions:
  id-token: write  # Required for OIDC
  contents: read   # Required for actions/checkout

jobs:
 build:
   runs-on: ubuntu-latest
  
   steps:
   - name: Checkout Code 
     uses: actions/checkout@v4

   - name: Set up JDK
     uses: actions/setup-java@v4
     with:
       java-version: '21'
       distribution: 'temurin'

   - name: Set up JFrog CLI
     id: setup-jfrog-cli
     uses: jfrog/setup-jfrog-cli@v4
     env:
       JF_URL: https://migration1.jfrog.io
     with:
       oidc-provider-name: github-test
       oidc-audience: my-aud
       disable-auto-build-publish: false

   - name: Maven Build and Install
     env:
       # Forces the JFrog CLI to use your wrapper (Maven 3.9.11)
       JF_MVN_PATH: ./mvnw 
     run: |
       # 1. Ensure the wrapper is executable
       chmod +x mvnw
       
       # 2. Configure Artifactory resolution
       jf mvnc --repo-resolve-releases test-libs-release \
               --repo-resolve-snapshots test-libs-snapshot \
               --repo-deploy-releases test-libs-release \
               --repo-deploy-snapshots test-libs-snapshot
       
       # 3. Run the build
       jf mvn clean install -U -ntp -B
